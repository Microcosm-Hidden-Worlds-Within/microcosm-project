<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">

    <!--Javascript for navbar-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="css/colors.css">
    <link rel="stylesheet" type="text/css" href="css/narrative-style.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/narrative-media.css">

    <!-- icon -->
    <link rel="shortcut icon" href="icons/logo/logo.ico" />

    <title>Narratives - Microcosm: Hidden Worlds Within</title>
</head>

<body>
    <header>
        <!-- Documentation for navbar at https://getbootstrap.com/docs/5.3/components/navbar/#how-it-works -->
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="index.html">
                    <img src="icons/logo/logo.png" alt="Logo">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="modal" data-bs-target="#navbarModal"
                    aria-controls="navbarModal" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="app.html">Exhibition</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="narratives.html">Narratives</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="map.html">Map</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="about_us.html">About us</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Modal Structure -->
    <div class="modal fade" id="navbarModal" tabindex="-1" aria-labelledby="navbarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <a class="modal-title" id="navbarModalLabel" href="index.html">
                        <img src="icons/logo/logo_full.svg" alt="Logo" style="height: 40px;">
                    </a>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Navbar content duplicated inside the modal -->
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="app.html">Exhibition</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="narratives.html">Narratives</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="map.html">Map</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="about_us.html">About us</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <main class="mb-5" id="my-main">
        <div class="text-center mt-5">
            <h1>Narratives</h1>
        </div>
    </main>

    <footer id="footer">
        <div class="container">
          <div>
            <p>
              The purpose of this web site is to explore various types of typographic and layout style for musem pages, as an end-of-course project for the <em>"Information Modeling and Web technologies"</em> course of the <em>Master Degree in Digital Humanities and Digital Knowledge</em> of the University of Bologna, under prof. Fabio Vitali. The documents contained in this web site have been selected for their length and complexity from Wellcome Collections. Their publication here is not intended to be an alternative or replace their original locations. Full attributions are found in the Documentation page.
            </p>
            <p>
              All copyrights and related rights on the content remain with their original owners.<br>
              All copyright on the typographic and layout choices are 2024 Â© Benini Ludovica, Casazza Simone, Ciarrocca
              Alberto, Pak Anna
            </p>
            <p><a href="documentation.html">Read full Documentation</a> | All icons from <a href="https://www.flaticon.com" target="_blank">flaticon.com</a></p>
          </div>
        </div>
      </footer>
      
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        let narrativeData = {};
        let narratives = [];
        // Intersection Observer for scroll-based activation
        document.addEventListener("DOMContentLoaded", async function (event) {
            fetch('narrative-data.json')
                .then(response => response.json())
                .then(data => {
                    narrativeData = data;
                    showNarrativesNav();
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        });

        function showNarrativesNav() {
            narratives = narrativeData.narratives;
            let firstNarrativeName = "";
            let newElements = "";
            newElements += `
                    <div class="nav-for-scroll sticky-top mt-5">
                        <ul class="nav nav-pills nav-justified">
                    `
            for (let i in narratives) {
                let narrativeName = narratives[i]["name"];
                let narrativeId = narratives[i]["name"];
                if (i == 0) {
                    newElements += "<li class=\"nav-item narrative-item\"><a href=\"#" + narrativeId + "\" class=\"nav-link active\" id=\"first-narrative\">" + narrativeName + "</a></li>";
                    firstNarrativeName = narrativeName;
                } else {
                    newElements += "<li class=\"nav-item narrative-item\"><a href=\"#" + narrativeId + "\" class=\"nav-link\">" + narrativeName + "</a></li>";
                };

            };
            newElements += `
                        </ul>
                    </div>
                    `
            byId("my-main").innerHTML += newElements;
            showCards();
        }

        function showCards() {
            for (let i = 0; i < narratives.length; i++) {
                let narrativeName = narratives[i]["name"];
                let narrativeId = narrativeName;
                let main = byId("my-main");
                let subnarratives = narratives[i]["subnarratives"];
                let cards = generateCards(subnarratives, narrativeName);
                let newCode = "<div class=\"container mt-5 section\" id=\"" + narrativeId + "\"><h2>" + narrativeName + "</h2>" + cards + "</div>";
                console.log(newCode);
                main.innerHTML += newCode;
            };
            createObserver();
        }


        function generateCards(param1, param2) {
            const mySheet = document.styleSheets[5];

            let result = ""
            for (let i = 0; i < param1.length; i++) {
                let subnarrativeName = param1[i]["name"];
                let subnarrativePic = "../" + param1[i]["pic"];
                let subnarrativeDesc = param1[i]["short-desc"];
                let backgroundImageClass = "card-img-bg-" + subnarrativeName.replaceAll(" ", "-");
                let encodedNarrativeName = encodeURIComponent(param2);
                let encodedSubnarrativeName = encodeURIComponent(subnarrativeName);
                let lastRowItem = i + 1;
                if (i % 4 == 0) {
                    result += "<div class=\"row\">";
                };
                result += `
                        <div class="col-12 col-md-6 col-xl-3 mt-3 d-flex">
                            <a href="app.html?narrative=${encodedNarrativeName}&subnarrative=${encodedSubnarrativeName}">
                            <div class="card h-100 w-100"> 
                            <div class="${backgroundImageClass}"></div>
                            <div class="card-body">
                                <h5 class="card-title">${subnarrativeName}</h5>
                                <p class="card-text mt-1">${subnarrativeDesc}</p>
                            </div>
                            </div>
                            </a>
                            </div>
                            `;

                let newRule = `
                        .${backgroundImageClass} {
                            background-image: url("${subnarrativePic}");
                        }
                        `;

                let ruleIndex = mySheet.insertRule(newRule, mySheet.cssRules.length);

                if (lastRowItem % 4 == 0 || i == param1.length - 1) {
                    result += "</div>";
                };
            };


            return result;
        }

        function byId(id) {
            return document.getElementById(id)
        }







        function createObserver() {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav .nav-link');

            const isMobile = window.matchMedia("(max-width: 991px)").matches;
            const threshold = isMobile ? 0.1 : 0.3;

            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: threshold
            };

            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href') === `#${entry.target.id}`);
                        });
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });
        }

    </script>
</body>

</html>